<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8">
  <title>å…‰å½±æŒ‘æˆ° AR ç‰ˆ</title>
  <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.css" />
  <style>
    body { margin:0; overflow:hidden; font-family:sans-serif; }
    #scoreboard {
      position: fixed; top: 10px; left: 50%; transform: translateX(-50%);
      z-index: 999; color:white; font-size:20px;
      background: rgba(0,0,0,0.5); padding:5px 10px; border-radius:8px;
    }
  </style>
</head>
<body>
  <div id="scoreboard">åˆ†æ•¸: 0 | æ™‚é–“: 30</div>

  <a-scene mindar-image="imageTargetSrc: travel-target.mind; autoStart:true" embedded vr-mode-ui="enabled:false" device-orientation-permission-ui="enabled:true">
    <a-camera id="camera" position="0 0 0" look-controls="enabled:false"></a-camera>

    <!-- Marker -->
    <a-entity mindar-image-target="targetIndex:0" id="marker">
      <!-- æ˜Ÿæ˜Ÿå®¹å™¨ -->
      <a-entity id="starsContainer"></a-entity>
    </a-entity>
  </a-scene>

  <script>
    const realMovies = ["ç„¡é–“é“", "èŠ±æ¨£å¹´è¯", "ç”œèœœèœœ", "é‡æ…¶æ£®æ—", "åŠŸå¤«", "è‹±é›„æœ¬è‰²"];
    const fakeMovies = ["å¤¢å¹»è¿½æ“Š", "å…‰å½±å¯†ç¢¼", "åˆå¤œä¹‹å¡”", "éŠ€æ²³é¢¨æš´", "è—å¤©è¡Œå‹•"];

    let score = 0;
    let timeLeft = 30;
    let gameRunning = true;

    const starsContainer = document.getElementById("starsContainer");
    const scoreboard = document.getElementById("scoreboard");

    function randomMovie() {
      const isReal = Math.random() > 0.5;
      const name = isReal
        ? realMovies[Math.floor(Math.random() * realMovies.length)]
        : fakeMovies[Math.floor(Math.random() * fakeMovies.length)];

      const x = (Math.random() - 0.5) * 1.2; // AR ç©ºé–“åæ¨™
      const y = 1.0; // å¾ä¸Šæ–¹æ‰è½
      const z = -0.5;

      const text = document.createElement('a-text');
      text.setAttribute('value', name);
      text.setAttribute('color', isReal ? '#FFD700' : '#FF69B4');
      text.setAttribute('position', `${x} ${y} ${z}`);
      text.setAttribute('scale', '0.3 0.3 0.3');
      text.setAttribute('look-at', '#camera');
      text.dataset.isReal = isReal;
      starsContainer.appendChild(text);
    }

    function updateStars() {
      const stars = starsContainer.children;
      for (let i = stars.length - 1; i >= 0; i--) {
        const star = stars[i];
        let pos = star.getAttribute('position');
        pos.y -= 0.01; // æ‰è½é€Ÿåº¦
        star.setAttribute('position', pos);
        if (pos.y < -0.5) starsContainer.removeChild(star);
      }
      if (gameRunning) requestAnimationFrame(updateStars);
    }

    function spawnLoop() {
      if (!gameRunning) return;
      randomMovie();
      setTimeout(spawnLoop, 800);
    }

    function countdown() {
      const timer = setInterval(() => {
        timeLeft--;
        scoreboard.textContent = `åˆ†æ•¸: ${score} | æ™‚é–“: ${timeLeft}`;
        if (timeLeft <= 0) {
          clearInterval(timer);
          gameRunning = false;
          alert(`éŠæˆ²çµæŸï¼ä½ å˜…åˆ†æ•¸ä¿‚ ${score} ğŸ‰`);
        }
      }, 1000);
    }

    // é»æ“Šå°„ç·šåˆ¤å®š
    const scene = document.querySelector('a-scene');
    scene.addEventListener('click', (evt) => {
      const cursorEl = scene.camera.el;
      const raycaster = cursorEl.components.raycaster;
      const intersects = raycaster.intersectObjects(starsContainer.object3D.children, true);
      if(intersects.length > 0){
        const obj = intersects[0].object.el;
        if(obj.dataset.isReal === 'true') score += 10;
        else score -= 5;
        scoreboard.textContent = `åˆ†æ•¸: ${score} | æ™‚é–“: ${timeLeft}`;
        starsContainer.removeChild(obj);
      }
    });

    spawnLoop();
    updateStars();
    countdown();
  </script>
</body>
</html>
