<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å…‰å½±æŒ‘æˆ° | AR ç‰ˆ</title>

<script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.css" />

<style>
html, body { 
  margin:0; padding:0; height:100%; 
  background:transparent; overflow:hidden; 
}
#gameCanvas { 
  position:absolute; top:0; left:0; display:none; 
  background:transparent; z-index:10; 
}
#ui {
  position: absolute; top: 10px; width: 100%; z-index: 11; font-size: 20px;
  display:none; text-align: center; color: white; pointer-events: none;
}
#score, #timer { margin: 0 15px; display: inline-block; }
a-scene { background: transparent !important; }
</style>
</head>

<body>

<!-- AR Scene -->
<a-scene mindar-image="imageTargetSrc: travel-target.mind; autoStart: true;"
         embedded
         vr-mode-ui="enabled: false"
         renderer="alpha: true"
         background="color: transparent">
  <a-camera position="0 0 0"></a-camera>
  <a-entity mindar-image-target="targetIndex:0" id="game-marker"></a-entity>
</a-scene>

<div id="ui">
  <span id="score">åˆ†æ•¸ï¼š0</span>
  <span id="timer">æ™‚é–“ï¼š30</span>
</div>

<canvas id="gameCanvas" width="400" height="600"></canvas>

<script>
// ----- éŠæˆ²é‚è¼¯ -----
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const ui = document.getElementById("ui");

const realMovies = ["ç„¡é–“é“","èŠ±æ¨£å¹´è¯","ç”œèœœèœœ","é‡æ…¶æ£®æž—","åŠŸå¤«","è‹±é›„æœ¬è‰²"];
const fakeMovies = ["å¤¢å¹»è¿½æ“Š","å…‰å½±å¯†ç¢¼","åˆå¤œä¹‹å¡”","éŠ€æ²³é¢¨æš´","è—å¤©è¡Œå‹•"];
let stars = [];
let score = 0, timeLeft = 30, gameRunning=false;
let spawnInterval=null, countdownInterval=null;

function randomMovie(){
  const isReal = Math.random()>0.5;
  const name = isReal
    ? realMovies[Math.floor(Math.random()*realMovies.length)]
    : fakeMovies[Math.floor(Math.random()*fakeMovies.length)];
  const x = Math.random()*(canvas.width-100)+20;
  const color = isReal ? "#FFD700" : "#FF69B4";
  stars.push({name,x,y:0,speed:Math.random()*2+1.5,isReal,color});
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.font="20px Noto Sans TC";
  stars.forEach(star=>{
    ctx.fillStyle=star.color;
    ctx.fillText(star.name, star.x, star.y);
    star.y += star.speed;
  });
  stars = stars.filter(s=>s.y<=canvas.height+20);
  if(gameRunning) requestAnimationFrame(draw);
}

canvas.addEventListener("click", e=>{
  const rect=canvas.getBoundingClientRect();
  const x=e.clientX-rect.left;
  const y=e.clientY-rect.top;
  for(let i=stars.length-1;i>=0;i--){
    const star=stars[i];
    const w=ctx.measureText(star.name).width;
    const h=24;
    const pad=5;
    if(x>star.x-pad && x<star.x+w+pad && y>star.y-h-pad && y<star.y+pad){
      score += star.isReal ? 10 : -5;
      document.getElementById("score").textContent=`åˆ†æ•¸ï¼š${score}`;
      stars.splice(i,1);
      break;
    }
  }
});

function startGame(){
  if(gameRunning) return;
  gameRunning=true;
  stars=[];
  score=0;
  timeLeft=30;
  document.getElementById("score").textContent=`åˆ†æ•¸ï¼š${score}`;
  document.getElementById("timer").textContent=`æ™‚é–“ï¼š${timeLeft}`;
  canvas.style.display="block";
  ui.style.display="block";
  draw();
  spawnInterval=setInterval(randomMovie,800);
  countdownInterval=setInterval(()=>{
    timeLeft--;
    document.getElementById("timer").textContent=`æ™‚é–“ï¼š${timeLeft}`;
    if(timeLeft<=0){ stopGame(); alert(`éŠæˆ²çµæŸï¼ä½ å˜…åˆ†æ•¸ä¿‚ ${score} ðŸŽ‰`);}
  },1000);
}

function stopGame(){
  gameRunning=false;
  canvas.style.display="none";
  ui.style.display="none";
  stars=[];
  clearInterval(spawnInterval);
  clearInterval(countdownInterval);
}

const markerEl=document.getElementById("game-marker");
markerEl.addEventListener("targetFound", startGame);
markerEl.addEventListener("targetLost", stopGame);

</script>
</body>
</html>
